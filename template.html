<html>
  <head>
    <title>copher | TITLE</title>
  <style>
body {
  margin: 0;
  font-family: monospace;
}

table {
  border-collapse: collapse;
  empty-cells: show;
}
tr {
  border: none;
}
td:first-child {
  text-align: center;
  min-width: 1em;
  background: lightgray;
  font-weight:bold;
}
td {
  padding-left: 0.2em;
  padding-right: 0.2em;
  font-size: x-large;
  white-space: pre;
  height: 1em;
}

abbr {
  text-decoration: none;
}

a {
  text-decoration: none;
}

a._text abbr:after { content: "\1F4C3"; }
a._menu abbr:after { content: "\2630"; }
a._mac-file abbr:after { content: "\1F80B"; }
a._dos-file abbr:after { content: "\1F80B"; }
a._uu-file abbr:after { content: "\1F80B"; }
a._search abbr:after { content: "\1F50D"; }
a._telnet abbr:after { content: "\1F5B3"; }
a._bin abbr:after { content: "\1F80B"; }
a._gif abbr:after { content: "\1F5BC"; }
a._image abbr:after { content: "\1F5BC"; }
a._3270 abbr:after { content: "\1F5B3"; }
a._html abbr:after { content: "\1F310"; }
a._sound abbr:after { content: "\1F50A"; }
a._png abbr:after { content: "\1F5BC"; }
a._pdf abbr:after { content: "\1F80B"; }
a._download abbr:after { content: "\1F80B"; }
/* these next ones should never occur, but just in case */
a._mirror abbr:after { content: "+"; }
a._info abbr:after { content: "i"; }
a._error abbr:after { content: "3"; }
a._cso abbr:after { content: "2"; }
a._end abbr:after { content: "."; }

  </style>
  <script>

{
  function cleanUrl(urlString) {
    if (!urlString.includes('://')) {
      urlString = 'gopher://';
    }
    if (urlString.startsWith('gophers://')) {
      urlString = urlString.replace(/^gophers:\/\//, 'gopher://secure@');
    }
    let [url0, url1, hostAndPort, ...rest] = urlString.split('/');
    let [host, port] = hostAndPort.split(':');
    if (port) {
      port = Number(port);
      if (port / 100000 >= 1) {
        port = port % 100000;
        if (!host.startsWith('secure@')) {
          host = 'secure@' + host;
        }
      }
    }
    hostAndPort = port ? `${host}:${port}` : host;
    urlString = [url0, url1, hostAndPort, ...rest].join('/');
    return urlString;
  }

  window.search = function search(url) {
    const query = prompt('Please enter your search term(s):');
    window.location.href = url + "%09" + query;
  }

  window.addEventListener("keyup", event => {
    if (event.code === 'ArrowLeft') {
      window.history.back();
    }
    if (event.code === 'ArrowRight') {
      window.history.forward();
    }
    if (event.code === 'KeyG') {
      const url = prompt('Enter a valid Gopher or S/Gopher URL:', document.title.split(' ')[2]);
      if (url) {
        window.location.href = cleanUrl(url);
      }
    }
  }, false);

  window.copherVersion = 'COPHER_VERSION';
}

USER_JS
  </script>
  </head>
  <body>
    <div>
      REPLACE_ME
    </div>
  </body>
</html>
